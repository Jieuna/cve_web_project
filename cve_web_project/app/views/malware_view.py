from flask import Blueprint, render_template, request, flash, url_for
from werkzeug.utils import secure_filename, redirect

import json

bp = Blueprint('malware', __name__, url_prefix='/malware')

json_data = json.load(open("cve_info.json", encoding="euc-kr"))
cve_list = json_data["CVE_info"]


@bp.route('/list')
def _list():
    return render_template('malware_creation/malware_list.html', cve_list=cve_list)


@bp.route('/create')
def create():
    return render_template('malware_creation/malware_create.html', cve_list=cve_list)


@bp.route('/history')
def history():
    return render_template('malware_creation/malware_check_history.html')


@bp.route('/detect')
def detect():
    return render_template('malware_detection/malware_detect.html')


@bp.route('/result')
def result():
    return render_template('malware_detection/malware_check_result.html')


@bp.route('/create/set', methods=['GET'])
def set_options():
    no = request.args["choose_cve"]
    return render_template('malware_creation/malware_set_options.html', no=no, cve_list=cve_list)


@bp.route('/upload', methods=['POST'])
def upload_file():
    file = request.files['file']
    if not file:
        return redirect(url_for('malware.detect'))
    file.save(secure_filename(file.filename))
    return 'success'
